<!DOCTYPE html>
<html>
<head>
  <title>üöú Submit Load</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    h1, h3 { margin-bottom: 10px; }
    form { margin-bottom: 20px; }
    label { display: block; margin-top: 10px; }
    input, select { padding: 6px; margin-top: 4px; width: 100%; max-width: 300px; }
    button { padding: 8px 12px; margin-top: 10px; cursor: pointer; }
    .section { margin-bottom: 40px; border-bottom: 1px solid #ccc; padding-bottom: 20px; }
  </style>
</head>
<body>

  <h1>üöú Submit Load</h1>
  <h3>Total Gallons Today: <%= totalGallons %></h3>
  <h3>Total Fuel Used Today: <%= totalFuel %></h3>

  <% if (lastLoad) { %>
    <p><strong>Last Load:</strong>
      <%= new Date(lastLoad.timestamp).toLocaleString("en-US", {
        timeZone: "America/New_York",
        hour12: true
      }) %>
      by <%= lastLoad.tractor.name %>
    </p>
  <% } %>

  <!-- Load Submission Form -->
  <div class="section">
    <form method="POST" action="/load">
      <label for="tractor">Tractor:</label>
      <select name="tractor" required>
        <% tractors.forEach(t => { %>
          <option value="<%= t._id %>" <%= t._id.toString() === selectedTractorId ? 'selected' : '' %>><%= t.name %></option>
        <% }) %>
      </select>

      <label for="farm">Farm:</label>
      <select name="farm" required>
        <% farms.forEach(f => { %>
          <option value="<%= f._id %>" <%= f._id.toString() === selectedFarmId ? 'selected' : '' %>><%= f.name %></option>
        <% }) %>
      </select>

      <label for="field">Field:</label>
      <select name="field">
        <% fields.forEach(f => { %>
          <option value="<%= f._id %>" <%= f._id.toString() === selectedFieldId ? 'selected' : '' %>><%= f.name %></option>
        <% }) %>
      </select>

      <label for="pit">Pit:</label>
      <select name="pit">
        <% pits.forEach(p => { %>
          <option value="<%= p._id %>"><%= p.name %></option>
        <% }) %>
      </select>

      <label for="startHour">Start Hour:</label>
      <input type="text" name="startHour" placeholder="e.g. 7.5">

      <label for="endHour">End Hour:</label>
      <input type="text" name="endHour" placeholder="e.g. 13.25">

      <button type="submit">‚úÖ Submit Load</button>
    </form>

    <!-- Show tracked hours if any -->
    <% if (trackedHours && Object.keys(trackedHours).length > 0) { %>
      <h3>‚è±Ô∏è Tracked Start Hours:</h3>
      <ul>
        <% Object.entries(trackedHours).forEach(([label, hour]) => { %>
          <li><strong><%= label %></strong>: <%= hour %></li>
        <% }) %>
      </ul>
    <% } %>
  </div>

  <!-- Submit End Hour Only -->
  <div class="section">
    <h2>‚è±Ô∏è Submit End Hour Only</h2>
    <form method="POST" action="/load/submit-end-hour">
      <label for="tractor">Tractor:</label>
      <select name="tractor" required>
        <% tractors.forEach(t => { %>
          <option value="<%= t._id %>"><%= t.name %></option>
        <% }) %>
      </select>

      <label for="farm">Farm:</label>
      <select name="farm" required>
        <% farms.forEach(f => { %>
          <option value="<%= f._id %>"><%= f.name %></option>
        <% }) %>
      </select>

      <label for="field">Field:</label>
      <select name="field">
        <% fields.forEach(f => { %>
          <option value="<%= f._id %>"><%= f.name %></option>
        <% }) %>
      </select>

      <label for="endHour">End Hour:</label>
      <input type="text" name="endHour" required placeholder="e.g. 13.25">

      <button type="submit">üì§ Submit End Hour</button>
    </form>
  </div>

  <!-- Fuel Section -->
  <div class="section">
    <h2>‚õΩ Submit Fuel Used</h2>
    <form method="POST" action="/load/submit-fuel">
      <label for="tractor">Tractor:</label>
      <select name="tractor" required>
        <% tractors.forEach(t => { %>
          <option value="<%= t._id %>"><%= t.name %></option>
        <% }) %>
      </select>

      <label for="field">Field:</label>
      <select name="field">
        <% fields.forEach(f => { %>
          <option value="<%= f._id %>"><%= f.name %></option>
        <% }) %>
      </select>

      <label for="amount">Gallons Used:</label>
      <input type="number" name="amount" step="0.01" required placeholder="e.g. 12.5">

      <button type="submit">‚õΩ Submit Fuel</button>
    </form>
  </div>

</body>
</html>
